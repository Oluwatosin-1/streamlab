{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="container-fluid my-3">
  <h2 class="mb-3">Streamlab Studio</h2>
  {% if configuration %}
    <p><strong>Configuration:</strong> {{ configuration.stream_title }}</p>
  {% else %}
    <p class="alert alert-warning">No configuration found. <a href="{% url 'streaming:config_create' %}">Create one</a> first.</p>
  {% endif %}
  
  <!-- Preview Section -->
  <div class="row">
    <div class="col-lg-6">
      <div class="card mb-3">
        <div class="card-header">
          <h5>Preview Feed</h5>
        </div>
        <div class="card-body p-0 position-relative">
          <video id="previewVideo" autoplay playsinline muted style="width: 100%; aspect-ratio: 16/9; object-fit: cover;"></video>
          <div id="noPreviewText" class="position-absolute top-50 start-50 translate-middle text-white" style="display: none;">
            <h6>No camera available for preview.</h6>
          </div>
        </div>
        <div class="card-footer">
          <button id="startPreviewBtn" class="btn btn-sm btn-outline-primary">Start Preview</button>
          <button id="stopPreviewBtn" class="btn btn-sm btn-outline-secondary">Stop Preview</button>
          <button id="switchScreenPreviewBtn" class="btn btn-sm btn-outline-info">Share Screen</button>
          <!-- Button to push preview to live -->
          <button id="pushToLiveBtn" class="btn btn-sm btn-outline-success">Push to Live</button>
        </div>
      </div>
    </div>
    
    <!-- Live Section -->
    <div class="col-lg-6">
      <div class="card mb-3">
        <div class="card-header">
          <h5>Live Feed</h5>
        </div>
        <div class="card-body p-0 position-relative">
          <video id="liveVideo" autoplay playsinline muted style="width: 100%; aspect-ratio: 16/9; object-fit: cover;"></video>
          <div id="noLiveText" class="position-absolute top-50 start-50 translate-middle text-white" style="display: none;">
            <h6>No live feed available.</h6>
          </div>
        </div>
        <div class="card-footer">
          <button id="startLiveBtn" class="btn btn-sm btn-outline-primary">Start Live Cam</button>
          <button id="stopLiveBtn" class="btn btn-sm btn-outline-secondary">Stop Live Cam</button>
          <button id="switchScreenLiveBtn" class="btn btn-sm btn-outline-info">Share Screen (Live)</button>
        </div>
      </div>
      
      <!-- Chat Section -->
      <div class="card mb-3">
        <div class="card-header">
          <h6>Live Chat</h6>
        </div>
        <div class="card-body" id="chatContainer" style="max-height: 200px; overflow-y: auto;">
          <!-- Chat messages loaded here via AJAX or websockets -->
        </div>
        <div class="card-footer">
          <div class="input-group">
            <input type="text" id="chatMessage" class="form-control" placeholder="Type a message...">
            <button id="sendChatBtn" class="btn btn-primary">Send</button>
          </div>
        </div>
      </div>
      
    </div>
  </div>
  
  <!-- Studio Controls -->
  <div class="d-flex justify-content-end gap-2 mt-3">
    {% if configuration %}
      <form method="post" action="{% url 'streaming:go_live' config_id=configuration.id %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">Go Live</button>
      </form>
    {% endif %}
    <button id="startRecordBtn" class="btn btn-outline-info">Start Recording</button>
    <button id="stopRecordBtn" class="btn btn-outline-warning" disabled>Stop Recording</button>
  </div>
</div>

<!-- Include your JavaScript for handling camera streams, chat, overlays, etc. -->
<script src="{% static 'js/studio.js' %}"></script>
{% endblock %}
